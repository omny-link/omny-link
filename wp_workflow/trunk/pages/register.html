<div>
  <h2>Not logged in</h2>
  <p>You can either log-in to your existing account or register a new one here.</p>
  <form method="post" >
<!--
    <input type="hidden" name="option_page" value="">
-->
    <input type="hidden" name="action" value="update">
    <table class="form-table">
      <tbody>
        <tr>
          <th scope="row"><label for="clientKey">Client Key</label></th>
          <td><input data-p-bind="$p.login.username" name="clientKey" type="text" id="clientKey" value="firmgains" class="regular-text"></td>
        </tr>
        <tr>
          <th scope="row"><label for="clientSecret">Client Secret</label></th>
          <td><input data-p-bind="$p.login.password" name="clientSecret" type="text" id="clientSecret" value="foo-bar" class="regular-text"></td>
        </tr>
      </tbody>
    </table>
    <p class="submit"><input data-p-action="register()" type="button" name="submit" id="submit" class="button button-primary" value="Save Changes"></p>
  </form>
  <script type="text/javascript">
    function register() {
      var jqxhr = $p.sendMessage('inOnly','kp.loginOrRegister.json',JSON.stringify($p.login));
      jqxhr.done(function( msg ) {
        console.debug("yah, we're in!");
        $.post('/wp-admin/admin-ajax.php', {
            'action': 'change_subscription',
            'syncapt_user': $p.login.username,
            'syncapt_pass': $p.login.password
          }, 
          function(response){
            console.debug('... stored ok, '+response);
            document.location.reload();
          }
        );
     });
    }
  </script>
</div>
