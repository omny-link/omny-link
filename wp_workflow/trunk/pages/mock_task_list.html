      <style>
        .btn { 
          margin-top: 20px;
        }
        .clickable:hover { 
          cursor:pointer;
        }
        .indicator { 
          width: 100%;
        }
      </style>
      <script type="text/javascript">
        function openTask(id) { 
          console.debug('Clicked open task: '+id);
          $p.task = $p.tasks[id];
          $p.sync();
          $('#taskForm').css('display','inline');
        }
        function submitFoo() {
          $('.p-messages').empty().append('Sending...').show();
          $('.btn').attr('disabled','disabled').css('background-color','#ccc');
          $p.sendMessage('inOnly','com.trakeo.procure.NewProduct.json',JSON.stringify($p.task))
            .done(function(data) {
              $('.p-messages').addClass('p-success');
              $('#taskDetails').slideToggle();
              $('#afterSubmit').slideToggle();
            });
        }
        function openProductPage(url) { window.open(url, '_newtab'); }
        jQuery(document).ready(function() {
         jQuery.getJSON(
              "/wp-content/plugins/syncapt/js/tasks.json", 
              function(tasks) {
                console.debug("Have "+tasks.length+" tasks: "+tasks);
                jQuery('#tasks-ctl').empty();
                $p.tasks = [];
                for (idx in tasks) { 
                  $p.tasks[tasks[idx].id] = tasks[idx]; 
                  jQuery('#tasks-ctl').append(jQuery('#tasksTemplate').html()).moustache(tasks[idx]);
                }
              });
        });
      </script>

<table style="display:none">
  <tbody  id="tasksTemplate" >
          <tr class="clickable" onclick="openTask({{id}});">
            <td>{{description}}</td>
            <td>{{type}}</td>
            <td>{{arrived}}</td>
            <td>{{started}}</td>
          </tr>
  </tbody>
</table>

      <table>
        <thead>
          <tr>
            <th>Description</th>
            <th>Type</th>
            <th>Arrived</th>
            <th>Case Started</th>
          </tr>
        <tbody id="tasks-ctl">
        </tbody>
      </table>

      <form id="taskForm" class="" role="form" style="display:none">
      
        <div class="p-messages" style="display:none;"> </div>

        <div id="taskDetails">
          <input class="decorate form-control" data-p-bind="$p.task.description" type="text" id="Name" name="Name" placeholder="Name" readonly/>
          <input class="decorate form-control" data-p-bind="$p.task.type" type="text" id="Type" name="Type" placeholder="Type" readonly/>
          <input class="decorate form-control" data-p-bind="$p.task.started" type="text" id="started" name="Case Started" readonly/>
          <input class="decorate form-control" data-p-bind="$p.task.arrived" type="text" id="arrived" name="Arrived" readonly/>
          <input class="decorate form-control" data-p-bind="$p.task.productRef" type="text" id="productRef" name="Product Reference" readonly/>
          <span class="decorate form-control" data-p-display="$p.task.productUrl" type="text" id="productUrl" name="Product URL" readonly style="display:none"></span>
          <a data-p-action="openProductPage($p.task.productUrl)">Link to Product page</a><br/>
          <textarea class="decorate form-control" data-p-bind="$p.task.assessment" type="text" id="Assessment" name="Assessment" placeholder="Write your evaluation here including most material indicators, quantification of the same and evidenced or estimated" readonly rows="3"></textarea>
          <label>Indicators</label>
          <table>
            <tbody>
              <tr>
                <th>Carbon footprint (kg)</th>
                <td>
          <input class="form-control indicator" data-p-bind="$p.task.carbon" type="text" id="carbon"/>
                </td>
                <td>
                  <label>Estimated? </label>
          <input class="form-control" data-p-bind="$p.task.carbonEstimated" type="checkbox" id="carbonEstimated"/>
                </td>
              </tr>
              <tr>
                <th>Social risk (%)</th>
                <td>
          <input class="form-control indicator" data-p-bind="$p.task.social" type="text" id="social"/>
                </td>
                <td>
                  <label>Estimated? </label>
          <input class="form-control" data-p-bind="$p.task.carbonEstimated" type="checkbox" id="carbonEstimated"/>
                </td>
              </tr>
              <tr>
                <th>Price ex VAT (Â£)</th>
                <td>
          <input class="form-control indicator" data-p-bind="$p.task.price" type="text" id="price"/>
                </td>
                <td>
                  <label>Estimated? </label>
          <input class="form-control" data-p-bind="$p.task.carbonEstimated" type="checkbox" id="carbonEstimated"/>
                </td>
              </tr>
            </tbody>
          </table>
        <div style="float:right;position:relative;top:-625px">
          <img src="http://www.careco.co.uk/csp/careco/mobility/products/320/WC01006_enigma_sp_lightweight_aluminium_.jpg"/>
        </div>
        <div>
          <input data-p-action="submitFoo();" type="button" value="Submit" id="send" class="btn btn-fwd decorate">
        </div>
        <p>Fields marked <span class="mandatory">*</span> are mandatory.</p> 
        </div>
    </form>
             

