<!--
  Copyright 2015-2018 Tim Stephenson and contributors
  
   Licensed under the Apache License, Version 2.0 (the "License"); you may not
   use this file except in compliance with the License.  You may obtain a copy
   of the License at
  
     http://www.apache.org/licenses/LICENSE-2.0
  
   Unless required by applicable law or agreed to in writing, software
   distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
   WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
   License for the specific language governing permissions and limitations under
   the License.
-->
<section class="container container-sticky">
  <h2 class="navbar-sticky">
    {{>navbar}}
    {{>profileArea}}
  </h2>
</section>

<section id="currentSect">
  <h2 class="navbar-top">
    {{>navbar}}
  </h2>

  <form class="inline-form form" id="currentForm">
	  <section id="featuresSect">
	    <h2 id="features">
	      <span class="ol-collapse glyphicon glyphicon-btn glyphicon-triangle-right" onclick="ractive.toggleSection($(this).closest('section'))"></span>
	      <span>Features enabled for </span>
	      <span contenteditable id="curName" on-focus="editField('#curName','current.name')" on-blur="updateField('#curName','current.name')">{{current.name}}</span>
	      <span id="curId" >({{current.id}})</span>
	    </h2>
	    <div class="currentBody col-md-6 col-sm-12 col-xs-12" style="display:none">
	      <ul class="form edit-form">
	        <li class="form-group">
	          <label class="col-md-4 col-sm-4">Account:</label>
	          <input id="curFeatureAccount" type="checkbox" checked="{{current.features.account}}"> {{#current.features.account==true}}Enabled{{/}}
	          <p class="col-md-offset-4 hidden-sm hidden-xs help-block">Enable if contacts need to be associated with a company or other organisation</p>
	        </li>
	        <li class="form-group">
	          <label class="col-md-4 col-sm-4">Account Financials:</label>
	          <input class="" id="curFeatureFinancials" type="checkbox" checked="{{current.features.financials}}"> {{#current.features.financials==true}}Enabled{{/}}
	          <p class="col-md-offset-4 hidden-sm hidden-xs help-block">Additional account fields</p>
	        </li>
	        <li class="form-group">
	          <label class="col-md-4 col-sm-4">Activity Analysis:</label>
	          <input id="curFeatureActivity" type="checkbox" checked="{{current.features.activityAnalysis}}"> {{#current.features.activityAnalysis==true}}Enabled{{/}}
	          <p class="col-md-offset-4 hidden-sm hidden-xs help-block">Displays recent activity information such as last login</p>
	        </li>
	        <li class="form-group">
	          <label class="col-md-4 col-sm-4">Activity Tracker:</label>
	          <input id="curFeatureActivityTracker" type="checkbox" checked="{{current.features.activityTracker}}"> {{#current.features.activityTracker==true}}Enabled{{/}}
	          <p class="col-md-offset-4 hidden-sm hidden-xs help-block"><em>Experimental!</em> Record actions of the user, such as login etc</p>
	        </li>
	        <li class="form-group">
	          <label class="col-md-4 col-sm-4">Address on Account:</label>
	          <input id="curFeatureAddressAccount" type="checkbox" checked="{{current.features.addressAccount}}"> {{#current.features.addressAccount==true}}Enabled{{/}}
	          <p class="col-md-offset-4 hidden-sm hidden-xs help-block">Whether accounts have addresses associated</p>
	        </li>
	        <li class="form-group">
	          <label class="col-md-4 col-sm-4">Address on Contact:</label>
	          <input id="curFeatureAddressContact" type="checkbox" checked="{{current.features.addressContact}}"> {{#current.features.addressContact==true}}Enabled{{/}}
	          <p class="col-md-offset-4 hidden-sm hidden-xs help-block">Whether contacts have addresses associated</p>
	        </li>
	        <li class="form-group">
	          <label class="col-md-4 col-sm-4">Budget:</label>
	          <input id="curFeatureBudget" type="checkbox" checked="{{current.features.budget}}"> {{#current.features.budget==true}}Enabled{{/}}
	          <p class="col-md-offset-4 hidden-sm hidden-xs help-block">Display fields to manage a contact's budget</p>
	        </li>
	        <li class="form-group">
	          <label class="col-md-4 col-sm-4">Company Data:</label>
	          <input class="" id="curFeatureCompanyBackground" type="checkbox" checked="{{current.features.companyBackground}}"> {{#current.features.companyBackground==true}}Enabled{{/}}
	          <p class="col-md-offset-4 hidden-sm hidden-xs help-block">Displays research information about the company</p>
	        </li>
	        <li class="form-group">
	          <label class="col-md-4 col-sm-4">Documents:</label>
	          <input class="" id="curFeatureDocuments" type="checkbox" checked="{{current.features.documents}}"> {{#current.features.documents==true}}Enabled{{/}}
	          <p class="col-md-offset-4 hidden-sm hidden-xs help-block">Allow documents links to be added to contacts</p>
	        </li>
	      </ul>
	    </div>
	    <div class="currentBody col-md-6 col-sm-12 col-xs-12" style="display:none">
	      <ul class="form edit-form">
	        <li class="form-group">
	          <label class="col-md-4 col-sm-4">Marketing:</label>
	          <input class="" id="curFeatureMarketing" type="checkbox" checked="{{current.features.marketing}}"> {{#current.features.marketing==true}}Enabled{{/}}
	          <p class="col-md-offset-4 hidden-sm hidden-xs help-block">Display marketing information about the source of the lead</p>
	        </li>
	        <li class="form-group">
	          <label class="col-md-4 col-sm-4">Marketing (Digital):</label>
	          <input class="" id="curFeatureDigitalMarketing" type="checkbox" checked="{{current.features.marketingDigital}}"> {{#current.features.marketingDigital==true}}Enabled{{/}}
	          <p class="col-md-offset-4 hidden-sm hidden-xs help-block">Specifically digital marketing information about the lead</p>
	        </li>
	        <li class="form-group">
	          <label class="col-md-4 col-sm-4">Merge:</label>
	          <input class="" id="curFeatureMerge" type="checkbox" checked="{{current.features.merge}}"> {{#current.features.merge==true}}Enabled{{/}}
	          <p class="col-md-offset-4 hidden-sm hidden-xs help-block"><em>Experimental!</em> Enable the experimental contact merge functionality</p>
	        </li>
	        <li class="form-group">
	          <label class="col-md-4 col-sm-4">Multi-national:</label>
	          <input class="" id="curFeatureMultiNational" type="checkbox" checked="{{current.features.multiNational}}"> {{#current.features.multiNational==true}}Enabled{{/}}
	          <p class="col-md-offset-4 hidden-sm hidden-xs help-block">Controls country field, and perhaps in the future more</p>
	        </li>
	        <li class="form-group">
	          <label class="col-md-4 col-sm-4">Offers:</label>
	          <input class="" id="curFeatureOffers" type="checkbox" checked="{{current.features.offers}}"> {{#current.features.offers==true}}Enabled{{/}}
	          <p class="col-md-offset-4 hidden-sm hidden-xs help-block">Promote a stock category, usually for a limited period</p>
	        </li>
	        <li class="form-group">
	          <label class="col-md-4 col-sm-4">Orders:</label>
	          <input class="" id="curFeatureOrders" type="checkbox" checked="{{current.features.orders}}"> {{#current.features.orders==true}}Enabled{{/}}
	          <p class="col-md-offset-4 hidden-sm hidden-xs help-block">Ability to record orders for one or more stock items against a contact</p>
	        </li>
	        <li class="form-group">
	          <label class="col-md-4 col-sm-4">Social on Account:</label>
	          <input class="" id="curSocialAccount" type="checkbox" checked="{{current.features.socialAccount}}"> {{#current.features.socialAccount==true}}Enabled{{/}}
	          <p class="col-md-offset-4 hidden-sm hidden-xs help-block">Whether accounts have social media accounts</p>
	        </li>
	        <li class="form-group">
	          <label class="col-md-4 col-sm-4">Social on Contact:</label>
	          <input class="" id="curSocialContact" type="checkbox" checked="{{current.features.socialContact}}"> {{#current.features.socialContact==true}}Enabled{{/}}
	          <p class="col-md-offset-4 hidden-sm hidden-xs help-block">Whether contacts have social media accounts</p>
	        </li>
	        <li class="form-group">
	          <label class="col-md-4 col-sm-4">Stock Pricing:</label>
	          <input class="" id="curStockPricing" type="checkbox" checked="{{current.features.stockPricing}}"> {{#current.features.stockPricing==true}}Enabled{{/}}
	          <p class="col-md-offset-4 hidden-sm hidden-xs help-block">Stock item pricing</p>
	        </li>
	        <li class="form-group">
	          <label class="col-md-4 col-sm-4">Support Bar:</label>
	          <input class="" id="curSupportBar" type="checkbox" checked="{{current.features.supportBar}}"> {{#current.features.supportBar==true}}Enabled{{/}}
	          <p class="col-md-offset-4 hidden-sm hidden-xs help-block">Display the tool to raise a support call</p>
	        </li>
	      </ul>
	    </div>
	  </section>
	</form>

  <section id="botSect" style="clear: both">
    <h2 id="bot">
       <span class="ol-collapse glyphicon glyphicon-btn glyphicon-triangle-right" onclick="ractive.toggleSection($(this).closest('section'))"></span>
       <span>Bot settings</span>
    </h2>
    <div style="display:none">
	    <table class="table table-striped">
	      <thead>
	        <tr>
	          <th class="col-md-2">API Key</th>
	          <!-- th class="col-md-2">API Secret</th-->
	          <th class="col-md-2">Contact Mgmt URL</th>
	          <th class="col-md-2">Contact Mgmt Secret</th>
	          <th class="col-md-2">Authentication URL</th>
	          <th class="col-md-2">CC Account</th>
	          <th class="col-md-2">Status</th>
	        </tr>
	      </thead>
	      <tbody>
	        <tr>
	          <td>{{current.bot.apiKey}}</td>
	          <!-- td>{{current.bot.apiSecret}}</td-->
	          <td>{{current.bot.custMgmtUrl}}</td>
	          <td>{{current.bot.custMgmtSecret}}</td>
	          <td>{{current.bot.jwtAuthUrl}}</td>
	          <td>{{current.bot.ccAccount}}</td>
	          <td>
	            {{# current.bot.valid==true}}
	              <span class="glyphicon glyphicon-ok-sign glyphicon-success" id="curBotValid" title="Deployed and ready"></span>
	            {{else}}
	              <span class="glyphicon glyphicon-btn glyphicon-remove-sign alert-danger" id="curBotInvalid" title="Missing or out of date"></span>
	              {{#if current.bot.apiKey}}
	                <span class="glyphicon glyphicon-btn glyphicon-repeat" id="curBotCreate" on-click="createBot(true)" title="Re-create the bot user"></span>
	              {{else}}
	                <span class="glyphicon glyphicon-btn glyphicon-repeat" id="curBotCreate" on-click="createBot(false)" title="Create the missing bot user"></span>
	              {{/if}}
	            {{/}}
	          </td>
	        </tr>
	      </tbody>
	    </table>
	  </div>
  </section>

  <section id="backupsSect">
    <h2 id="backups">
      <span class="ol-collapse glyphicon glyphicon-btn glyphicon-triangle-right" onclick="ractive.toggleSection($(this).closest('section'))"></span>
      <span>Data backup</span>
    </h2>
    <div style="display:none">
			<table class="table table-striped">
			  <thead>
			    <tr>
			      <th></th>
			      <th class="col-md-2">Name</th>
			      <th class="col-md-8">Current count</th>
			      <th class="col-md-2">Actions</th>
			    </tr>
			  </thead>
			  <tbody>
			    <tr>
			      <td>1</td>
			      <td class="col-md-2">{{# tenant.strings.accounts}}{{tenant.strings.accounts}}{{else}}Accounts{{/}}</td>
			      <td class="col-md-8">{{currentSummary.accounts}}</td>
			      <td class="col-md-2">
			        <a aria-hidden="true" class="glyphicon glyphicon-btn glyphicon-cloud-download" download="accounts.csv" on-click="download('accounts')" title="Download CSV file"></a>
			      </td>
			    </tr>
			    <tr>
			      <td>2</td>
			      <td class="col-md-2">{{# tenant.strings.contacts}}{{tenant.strings.contacts}}{{else}}Contacts{{/}}</td>
			      <td class="col-md-8">{{currentSummary.contacts}}</td>
			      <td class="col-md-2">
			        <a aria-hidden="true" class="glyphicon glyphicon-btn glyphicon-cloud-download" on-click="download('contacts')" title="Download CSV file"></a>
			      </td>
			    </tr>
			    <tr>
			      <td>3</td>
			      <td class="col-md-2">{{# tenant.strings.orders}}{{tenant.strings.orders}}{{else}}Orders{{/}}</td>
			      <td class="col-md-8">{{currentSummary.orders}}</td>
			      <td class="col-md-2">
			        <a aria-hidden="true" class="glyphicon glyphicon-btn glyphicon-cloud-download" on-click="download('orders')" title="Download CSV file"></a>
			      </td>
			    </tr>
			    <tr>
			      <td>4</td>
			      <td class="col-md-2">{{# tenant.strings.stockItems}}{{tenant.strings.stockItems}}{{else}}Stock Items{{/}}</td>
			      <td class="col-md-8">{{currentSummary.stockItems}}</td>
			      <td class="col-md-2">
			        <a aria-hidden="true" class="glyphicon glyphicon-btn glyphicon-cloud-download" on-click="download('stock-items')" title="Download CSV file"></a>
			      </td>
			    </tr>
			    <tr>
			      <td>5</td>
			      <td class="col-md-2">{{# tenant.strings.stockCategories}}{{tenant.strings.stockCategories}}{{else}}Stock Categories{{/}}</td>
			      <td class="col-md-8">{{currentSummary.stockCategories}}</td>
			      <td class="col-md-2">
			        <a aria-hidden="true" class="glyphicon glyphicon-btn glyphicon-cloud-download" on-click="download('stock-categories')" title="Download CSV file"></a>
			      </td>
			    </tr>
			    <tr>
			      <td>6</td>
			      <td class="col-md-2">{{# tenant.strings.tasks}}{{tenant.strings.tasks}}{{else}}Tasks{{/}}</td>
			      <td class="col-md-8">{{currentSummary.tasks}}</td>
			      <td class="col-md-2">
			        <a aria-hidden="true" class="glyphicon glyphicon-btn glyphicon-cloud-download" on-click="download('tasks')" title="Download CSV file"></a>
			      </td>
			    </tr>
			  </tbody>
			</table>
    </div>
  </section>

  <section id="toolbarSect">
    <h2 id="toolbar">
      <span class="ol-collapse glyphicon glyphicon-btn glyphicon-triangle-right" onclick="ractive.toggleSection($(this).closest('section'))"></span>
      <span>Toolbar entries</span>
    </h2>
    <div style="display:none">
      {{>statusTable { property: 'toolbar' }}}
    </div>
  </section>

  <section id="actionSect">
    <h2 id="actions">
      <span class="ol-collapse glyphicon glyphicon-btn glyphicon-triangle-right" onclick="ractive.toggleSection($(this).closest('section'))"></span>
      <span>Actions</span>
    </h2>
    <div style="display:none">
	    <h3 id="accountActions">{{# tenant.strings.account}}{{tenant.strings.account}}{{else}}Account{{/}} Actions</h3>
	    {{>statusTable { property: 'accountActions', showStatus: false }}}
	    <h3 id="contactActions">{{# tenant.strings.contacts}}{{tenant.strings.contacts}}{{else}}Contact{{/}} Actions</h3>
	    {{>statusTable { property: 'contactActions', showStatus: false }}}
	    <h3 id="orderActions">{{# tenant.strings.order}}{{tenant.strings.order}}{{else}}Order{{/}} Actions</h3>
	    {{>statusTable { property: 'orderActions', showStatus: false }}}
      <h3 id="purchaseOrderActions">{{# tenant.strings.purchaseOrder}}{{tenant.strings.purchaseOrder}}{{else}}Purchase Order{{/}} Actions</h3>
      {{>statusTable { property: 'purchaseOrderActions', showStatus: false }}}
	  </div>
  </section>

  <section id="filterSect">
    <h2 id="filters">
      <span class="ol-collapse glyphicon glyphicon-btn glyphicon-triangle-right" onclick="ractive.toggleSection($(this).closest('section'))"></span>
      <span>Filters</span>
    </h2>
    <div class="currentBody col-md-12 col-sm-12 col-xs-12" style="display:none">
      <table class="table table-striped">
        <tbody>
          <tr><th>Stages deemed 'inactive':</th><td>{{current.serviceLevel.inactiveStages}}</td></tr>
        </tbody>
      </table>
    </div>
  </section>

  <section id="sequencesSect">
    <h2 id="sequences">
      <span class="ol-collapse glyphicon glyphicon-btn glyphicon-triangle-right" onclick="ractive.toggleSection($(this).closest('section'))"></span>
      <span>Sequences</span>
    </h2>
	  <div style="display:none">
	    <table class="table table-striped">
	      <thead>
	        <tr>
	          <th></th>
	          <th class="col-md-2">Name</th>
	          <th class="col-md-2">Entity</th>
	          <th class="col-md-6">Description</th>
	          <th class="col-md-2">Last Used</th>
	        </tr>
	      </thead>
	      <tbody>
	        {{#each current.sequences:i}}
	          <tr data-href="{{_links.self.href}}">
	            <td>{{i+1}}</td>
	            <td class="col-md-2">{{name}}</td>
	            <td class="col-md-2">{{ref}}</td>
	            <td class="col-md-6">{{{description}}}</td>
	            <td class="col-md-2">{{status}}</td>
	          </tr>
	        {{/each}}
	        {{^current.sequences}}
	          <tr><td colspan="5">None</td></tr>
	        {{/}}
	      </tbody>
	    </table>
	  </div>
	</section>

  <section id="processeSect">
    <h2 id="processes">
      <span class="ol-collapse glyphicon glyphicon-btn glyphicon-triangle-right" onclick="ractive.toggleSection($(this).closest('section'))"></span>
      <span>Processes</span>
    </h2>
    <div style="display:none">
      {{>statusTable { property: 'processes' }}}
    </div>
  </section>

  <section id="partialSect">
    <h2 id="partials">
      <span class="ol-collapse glyphicon glyphicon-btn glyphicon-triangle-right" onclick="ractive.toggleSection($(this).closest('section'))"></span>
      <span>Partials</span>
    </h2>
    <div style="display:none">
      {{>statusTable { property: 'partials' }}}
    </div>
  </section>

  <section id="slaSect">
    <h2 id="slas">
      <span class="ol-collapse glyphicon glyphicon-btn glyphicon-triangle-right" onclick="ractive.toggleSection($(this).closest('section'))"></span>
      <span>Service Level Alerts</span>
    </h2>
    <div style="display:none">
	    <table class="table table-striped">
	      <thead>
	        <tr><th>Name</th><th>Value (days)</th></tr>
	      </thead>
	      <tbody>
	        <tr><td>Inactivity Reminder Threshold</td><td>{{current.serviceLevel.inactivityReminderThreshold}}</td></tr>
	        <tr><td>Inactivity Threshold</td><td>{{current.serviceLevel.inactivityThreshold}}</td></tr>
	        <tr><td>Initial Response Threshold</td><td>{{current.serviceLevel.initialResponseThreshold}}</td></tr>
	      </tbody>
	    </table>
	  </div>
  </section>

  <section id="templateSect">
    <h2 id="templates">
      <span class="ol-collapse glyphicon glyphicon-btn glyphicon-triangle-right" onclick="ractive.toggleSection($(this).closest('section'))"></span>
      <span>Templates</span>
    </h2>
    <div style="display:none">
      {{>statusTable { property: 'templates' }}}
    </div>
  </section>

  <section id="typeaheadControlSect">
    <h2 id="typeaheads">
      <span class="ol-collapse glyphicon glyphicon-btn glyphicon-triangle-right" onclick="ractive.toggleSection($(this).closest('section'))"></span>
      <span>Typeahead controls</span>
    </h2>
    <div style="display:none">
      {{>statusTable { property: 'typeaheadControls' }}}
    </div>
  </section>

</section>
