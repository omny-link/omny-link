<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<definitions xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:activiti="http://activiti.org/bpmn" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" xmlns:tns="http://omny.link/custmgmt" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:yaoqiang="http://bpmn.sourceforge.net" exporter="Yaoqiang BPMN Editor" exporterVersion="2.2.22 (GPLv3, Non-Commercial)" expressionLanguage="http://activiti.org/Juel" id="ConfirmEmailDefinitions" name="" targetNamespace="http://omny.link/custmgmt" typeLanguage="http://www.w3.org/2001/XMLSchema" xsi:schemaLocation="http://www.omg.org/spec/BPMN/20100524/MODEL http://bpmn.sourceforge.net/schemas/BPMN20.xsd">
  <process id="RecommendFollowUp" isClosed="false" isExecutable="true" name="Recommend an email follow up without sending" processType="None">
    <documentation id="ConfirmEmail_D_1" textFormat="text/plain"><![CDATA[Recommend an email follow up without sending.]]></documentation>
    <extensionElements>
      <yaoqiang:pageFormat height="842.4" imageableHeight="832.4" imageableWidth="587.6" imageableX="5.0" imageableY="5.0" orientation="0" width="597.6"/>
      <yaoqiang:page background="#FFFFFF" horizontalCount="1" verticalCount="1"/>
    </extensionElements>
    <ioSpecification>
      <dataInput id="_8" isCollection="false" name="contactId"/>
      <dataInput id="_3" isCollection="false" name="tenantId"/>
      <inputSet>
        <dataInputRefs>_8</dataInputRefs>
        <dataInputRefs>_3</dataInputRefs>
      </inputSet>
      <outputSet/>
    </ioSpecification>
    <sequenceFlow id="_15" sourceRef="startEvent" targetRef="readContact"/>
    <sequenceFlow id="_27" sourceRef="recordActivity" targetRef="endEvent"/>
    <startEvent id="startEvent" isInterrupting="true" name="Start Event" parallelMultiple="false">
      <outgoing>_15</outgoing>
      <outputSet/>
    </startEvent>
    <serviceTask activiti:class="com.knowprocess.resource.spi.RestGet" completionQuantity="1" id="readContact" implementation="##WebService" isForCompensation="false" name="Read Contact" startQuantity="1">
      <extensionElements>
        <activiti:field name="resourceUsername">
          <activiti:string>userInfo('tenant-bot')</activiti:string>
        </activiti:field>
        <activiti:field name="resourcePassword">
          <activiti:expression>userInfo('cust-mgmt-secret')</activiti:expression>
        </activiti:field>
        <activiti:field name="jwtLoginResource">
          <activiti:expression>userInfo('jwt-login-url')</activiti:expression>
        </activiti:field>
        <activiti:field name="globalResource">
          <activiti:expression>${contactId}?projection=complete</activiti:expression>
        </activiti:field>
        <activiti:field name="headers">
          <activiti:string>Accept:application/json</activiti:string>
        </activiti:field>
        <activiti:field expression="contact" name="responseVar"/>
      </extensionElements>
      <incoming>_15</incoming>
      <outgoing>_4</outgoing>
    </serviceTask>
    <sequenceFlow id="_4" sourceRef="readContact" targetRef="evaluateDecision"/>
    <serviceTask activiti:class="com.knowprocess.resource.spi.RestGet" completionQuantity="1" id="evaluateDecision" implementation="##WebService" isForCompensation="false" name="Evaluate decision to determine action" startQuantity="1">
      <extensionElements>
        <activiti:field name="resourceUsername">
          <activiti:string>userInfo('tenant-bot')</activiti:string>
        </activiti:field>
        <activiti:field name="resourcePassword">
          <activiti:expression>userInfo('cust-mgmt-secret')</activiti:expression>
        </activiti:field>
        <activiti:field name="jwtLoginResource">
          <activiti:expression>userInfo('jwt-login-url')</activiti:expression>
        </activiti:field>
        <activiti:field name="globalResource">
          <activiti:expression>userInfo('cust-mgmt-url')/${tenantId}/onedecision/EmailDecisions/DetermineEmailToSend</activiti:expression>
        </activiti:field>
        <activiti:field name="headers">
          <activiti:string>Accept:application/json</activiti:string>
        </activiti:field>
        <activiti:field name="data">
          <activiti:expression>contact=${contact}</activiti:expression>
        </activiti:field>
        <activiti:field expression="decisionResponse" name="responseVar"/>
      </extensionElements>
      <incoming>_4</incoming>
      <outgoing>_2</outgoing>
    </serviceTask>
    <callActivity calledElement="AddActivityToContact" completionQuantity="1" id="recordActivity" isForCompensation="false" name="Record&#10;recommendation" startQuantity="1">
      <extensionElements>
        <activiti:in sourceExpression="decision" target="activityType"/>
        <activiti:in sourceExpression="Decision: ${decisionResponse.getString('email', 'None applicable')}" target="activityContent"/>
        <activiti:in source="contactId" target="contactId"/>
        <activiti:in source="tenantId" target="tenantId"/>
        <activiti:out source="activityId" target="activityId"/>
      </extensionElements>
      <incoming>_2</incoming>
      <outgoing>_27</outgoing>
    </callActivity>
    <endEvent id="endEvent" name="End with success">
      <incoming>_27</incoming>
      <inputSet/>
    </endEvent>
    <sequenceFlow id="_2" sourceRef="evaluateDecision" targetRef="recordActivity"/>
    <textAnnotation id="_7" textFormat="text/plain">
      <text>RUN FOLLOW UP DECISION AS DRY RUN, AND RECORD AS ACTIVITY</text>
    </textAnnotation>
  </process>
  <bpmndi:BPMNDiagram id="Yaoqiang_Diagram-_1" name="Recommend follow-up email" resolution="96.0">
    <bpmndi:BPMNPlane bpmnElement="RecommendFollowUp">
      <bpmndi:BPMNShape bpmnElement="startEvent" id="Yaoqiang-startEvent">
        <dc:Bounds height="32.0" width="32.0" x="47.0" y="217.5"/>
        <bpmndi:BPMNLabel>
          <dc:Bounds height="18.955078125" width="63.0" x="31.5" y="258.5625"/>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="readContact" id="Yaoqiang-readContact">
        <dc:Bounds height="87.0" width="124.0" x="136.875" y="190.0"/>
        <bpmndi:BPMNLabel>
          <dc:Bounds height="18.955078125" width="77.0" x="160.375" y="226.0224609375"/>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="_7" id="Yaoqiang-_7">
        <dc:Bounds height="33.0" width="505.0" x="39.0" y="42.0"/>
        <bpmndi:BPMNLabel>
          <dc:Bounds height="18.955078125" width="364.0" x="39.0" y="51.0224609375"/>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="_8" id="Yaoqiang-_8">
        <dc:Bounds height="38.0" width="29.0" x="47.0" y="341.5"/>
        <bpmndi:BPMNLabel>
          <dc:Bounds height="18.955078125" width="56.0" x="33.5" y="381.5"/>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="endEvent" id="Yaoqiang-endEvent">
        <dc:Bounds height="32.0" width="32.0" x="650.5" y="217.5"/>
        <bpmndi:BPMNLabel>
          <dc:Bounds height="18.955078125" width="97.0" x="618.0" y="258.0673828125"/>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="recordActivity" id="Yaoqiang-recordActivity" isExpanded="false">
        <dc:Bounds height="87.0" width="124.0" x="468.625" y="190.0"/>
        <bpmndi:BPMNLabel>
          <dc:Bounds height="18.955078125" width="80.0" x="490.625" y="219"/>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="_3" id="Yaoqiang-_3">
        <dc:Bounds height="38.0" width="29.0" x="47.0" y="414.44444444444446"/>
        <bpmndi:BPMNLabel>
          <dc:Bounds height="18.955078125" width="50.0" x="36.5" y="454.44444444444446"/>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="evaluateDecision" id="Yaoqiang-evaluateDecision">
        <dc:Bounds height="87.0" width="124.0" x="302.75" y="190.0"/>
        <bpmndi:BPMNLabel>
          <dc:Bounds height="32.955078125" width="112.0" x="308.75" y="219.0224609375"/>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge bpmnElement="_15" id="Yaoqiang-_15">
        <di:waypoint x="79.49218559171948" y="233.5"/>
        <di:waypoint x="136.5" y="233.5"/>
        <bpmndi:BPMNLabel>
          <dc:Bounds height="18.955078125" width="6.0" x="104.99609279585974" y="224.0224609375"/>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="_4" id="Yaoqiang-_4">
        <di:waypoint x="260.5" y="233.5"/>
        <di:waypoint x="302.5" y="233.5"/>
        <bpmndi:BPMNLabel>
          <dc:Bounds height="18.955078125" width="6.0" x="278.5" y="224.0224609375"/>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="_2" id="Yaoqiang-_2">
        <di:waypoint x="426.5" y="233.5"/>
        <di:waypoint x="468.5" y="233.5"/>
        <bpmndi:BPMNLabel>
          <dc:Bounds height="18.955078125" width="6.0" x="444.5" y="224.0224609375"/>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="_27" id="Yaoqiang-_27">
        <di:waypoint x="592.5" y="233.5"/>
        <di:waypoint x="650.5078144082805" y="233.5"/>
        <bpmndi:BPMNLabel>
          <dc:Bounds height="18.955078125" width="6.0" x="618.5039072041402" y="224.0224609375"/>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</definitions>
