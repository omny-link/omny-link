<!doctype html>
<html lang='en-GB'>
<head>
  <meta charset='utf-8'>
  <title>Customer Management</title>
  <!-- 
  <link href='http://fonts.googleapis.com/css?family=Poiret+One' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Lato:400italic,400' rel='stylesheet' type='text/css'>
  -->
  <link href='http://fonts.googleapis.com/css?family=Roboto:400italic,400,700' rel='stylesheet' type='text/css'>
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <link href="css/firm-gains-0.1.0.css" rel="stylesheet">
  <link rel="icon" type="image/png" href="images/icon/firm-gains-icon-16x16.png" />
</head>

<!--
  1. This is the element we'll render our Ractive to.
-->
<body class="container" id="container">

  <!--
       2. You can load a template in many ways. For convenience, we'll include it in
       a script tag so that we don't need to mess around with AJAX or multiline strings.
       Note that we've set the type attribute to 'text/ractive' - though it can be
       just about anything except 'text/javascript'
  -->
  <script id='template' type='text/ractive'>
    <h1>
      <a class="nav navbar-brand" href="http://omny.link">
        <img src="/images/firm-gains-logo.png" alt="logo"/>
      </a>
      <span>Customer Management</span>
    </h1>
    <div class="clearfix" id="messages">
       <p class=" bg-danger text-danger">Beta! Please ensure you have backups!</p>
    </div>
    
      <section id="contactsSect">
        <h2>
          <span>Contacts</span>
          <span class="clickable glyphicon glyphicon-plus" aria-hidden="true" onclick="ractive.add()"></span>
          <input type="search" class="form-control search" placeholder="Search" value="{{searchTerm}}">
          <span class="glyphicon glyphicon-search" aria-hidden="true"></span>
       </h2>
        <table id="contactsTable" class="table table-striped">
          <thead>
            <tr>
              <th></th>
              <th>Full Name</th>
              <th>Business Name</th>
              <th>Owned by</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
          {{#each contacts:i}}
            {{# searchTerm!=undefined && (
                  this.firstName.toLowerCase().indexOf(searchTerm.toLowerCase())===0 
                  || this.lastName.toLowerCase().indexOf(searchTerm.toLowerCase())===0) }}
              <tr data-href="{{_links.self.href}}" on-click="edit(this)">
                <td>{{i+1}}</td>
                <td>{{firstName}} {{lastName}}</td>
                <td>{{account.name}}</td>
                <td>{{owner}}</td>
                <td>
                  <span class="clickable glyphicon glyphicon-remove" aria-hidden="true" onclick="ractive.delete('{{_links.self.href}}')"></span>
                  <span class="clickable glyphicon glyphicon-pencil" aria-hidden="true"></span>
                </td>
              </tr>
            {{/}}
          {{/each}}
          </tbody>
        </table>
      </section>

      <section id="currentSect" style="display:none">
        <form id="currentForm">
          <div class="form create-form">
            <input class="col-xs-1" id="curTitle" placeholder="Title" value="{{current.title}}"/>
            <input class="col-xs-2" id="curFirstName" placeholder="First Name" required value="{{current.firstName}}"/>
            <input class="col-xs-2" id="curLastName" placeholder="Last Name" required value="{{current.lastName}}"/>
            <input class="col-xs-2 typeahead pull-right" id="curOwner" placeholder="Owner" value="{{current.owner}}"/>
          </div>

          <h2 class="form create-form">&nbsp;</h2>
          <h2 class="form edit-form">
            <span contenteditable id="curTitle2" on-focus="editField('#curTitle2','current.title')" on-blur="updateField('#curTitle2','current.title')">{{current.title}}</span>
            <span contenteditable id="curFirstName2" on-focus="editField('#curFirstName2','current.firstName')" on-blur="updateField('#curFirstName2','current.firstName')">{{current.firstName}}</span>
            <span contenteditable id="curLastName2" on-focus="editField('#curLastName2','current.lastName')" on-blur="updateField('#curLastName2','current.lastName')">{{current.lastName}}</span>
            <span class="pull-right" style="font-style:italic">
              <span>Owner: </span><span contenteditable id="curOwner2" on-focus="editField('#curOwner2','current.owner')" on-blur="updateField('#curOwner2','current.owner')">{{current.owner == '' ? 'Click to assign' : current.owner}}</span>
            </span>
          </h2>

          <div id="currentBody" class="col-md-6">
            <ul class="form edit-form">
              <li><label>Email:</label><input id="curEmail" required value="{{current.email}}"></li>
              <li><label>Preferred Phone:</label><input id="curPhone1" value="{{current.phone1}}"></li>
              <li><label>Alternate Phone:</label><input id="curPhone2" value="{{current.phone2}}"></li>
              <li><label>Address:</label><input id="curAddress1" value="{{current.address1}}"/></li>
              <li><label></label><input id="curAddress2" value="{{current.address2}}"/></li>
              <li><label></label><input id="curCountyOrCity" value="{{current.countyOrCity}}"/></li>
              <li><label>Post Code:</label><input id="curPostCode" value="{{current.postCode}}"></li>
            </ul>
          </div>
          <div class="col-md-6">
            <ul class="form edit-form">
              <li><label>Enquiry Type:</label><input id="curEnquiryType" value="{{current.enquiryType}}"></li>
              <li><label>Budget:</label><input id="curBudget" value="{{current.budget}}"></li>
              <li><label>Stage:</label><input class="typeahead" id="curStage" value="{{current.stage}}"></li>
              <li><label>Source:</label><input class="typeahead" id="curSource" value="{{current.source}}"></li>
              <li><label>Medium:</label><input class="typeahead" id="curMedium" value="{{current.medium}}"></li>
            </ul>
          </div>
</form>
<form id="currentAccountForm">
          <div id="currentAccount" style="clear: both">
            
            <h2 class="form">Account</h2>

            <div class="col-md-6">
              <ul class="form edit-form">
                <li><label>Company Name:</label><input id="curAccountName" required value="{{current.account.name}}"></li>
                <li><label>Company Number:</label><input id="curCompanyNumber" pattern="[0-9]{8}" value="{{current.account.companyNumber}}"></li>
                <li><label>Website:</label><input id="curBusinessWebsite" value="{{current.account.businessWebsite}}"></li>
              </ul> 
            </div>
            <div class="col-md-6">
              <ul class="form edit-form">
                <li><label>Also known as:</label><input id="curAliases" value="{{current.account.aliases}}"></li>
                <li><label>No. of employees:</label><input id="curNoOfEmployees" value="{{current.account.noOfEmployees}}"/>
              </ul>
            </div>
          </div>

          <div id="currentAccountDesc" style="clear: both" class="col-md-12">
              <ul class="form edit-form">
                <li><label>Short description:</label><textarea id="curShortDesc" cols="80" value="{{current.account.shortDesc}}"></textarea></li>
                <li><label>Description:</label><textarea id="curDescription" cols="80" value="{{current.account.description}}"></textarea></li>
              </ul>
          </div>

          <div id="currentAccountExtended" style="clear: both">
            {{>(tenant.name+'AccountExtension')}}

            <!-- TODO General purpose account extension if no dedicated one available 
            {{#if tenant.accountFields}}
              <div class="col-md-12" id="currentAccountExtended">
                <h2 class="form">
                  <span>More...</span>
                </h2>

                <!-- first column - ->  
                {{>column {object: current.account, fields: tenant.accountFields.slice(0,Math.floor(tenant.accountFields.length/2))} }}

                <!-- second column - ->  
                {{>column {object: current.account, fields: tenant.accountFields.slice(Math.ceil(tenant.accountFields.length/2),tenant.accountFields.length)} }}

              </div>
            {{/if}}-->
          </div>

        </form>

      </section>

    <!-- PARTIALS FOLLOW AS CANNOT CURRENTLY USE SEPERATE ELEMENT TODO --> 

    <!-- {{>firmgainsAccountExtension}} -->
      <div class="col-md-12" id="currentAccountExtended">
        <h2 class="form"><span>More...</span></h2> 
        <div class="col-md-6">
          <ul class="form edit-form">
            <li><label>Account Type:</label><input id="curAccountType" value="{{current.account.customFields['accountType']}}"/></li>
<!--            
<li><label>Stage in Sale:</label><input id="curStageInSale" value="{{current.account.customFields['stageInSale']}}"/></li>
            --><li><label>Region:</label><input id="curRegion" value="{{current.account.customFields['region']}}"/></li>
          </ul>
        </div> 
        <div class="col-md-6">
          <ul class="form edit-form">
            <li><label>Sector:</label><input id="curSector" value="{{current.account.customFields['sector']}}"/></li>
            <li><label>Sub-Sector:</label><input id="curSubSector" value="{{current.account.customFields['subSector']}}"/></li>
          </ul>
        </div>
      </div>

      <div id="currentAccountProperty" style="clear: both" class="col-md-12">
        <ul class="form edit-form">
<fieldset>
          <legend>Furthermore...</legend>
        
          <li><label>Reason for Selling:</label><textarea cols="80" id="curReasonForSale" value="{{current.account.customFields['reasonForSale']}}"></textarea></li>
          <li><label>Potential Purchasers:</label><textarea cols="80" id="curPotentialPurchasers" value="{{current.account.customFields['potentialPurchasers']}}"></textarea></li>
          <li><label>Property Info:</label><textarea cols="80" id="curPropertyInfo" value="{{current.account.customFields['propertyInfo']}}"></textarea></li>
</fieldset>
        </ul>
      </div>


      <div class="col-md-12" id="currentAccountFinancials">
        <h2 class="form"><span>Financials</span></h2> 
        <div class="col-md-6">
          <ul class="form edit-form">
            <li><label>EBITDA:</label><input id="curUnknown" value="{{current.account.customFields['ebitda']}}"/></li>
            <li><label>Surplus:</label><input id="curSurplus" value="{{current.account.customFields['surplus']}}"/></li>
            <li><label>Depreciation:</label><input id="curDepreciation" value="{{current.account.customFields['depreciationAmortisation']}}"/></li>
          </ul>
        </div> 
        <div class="col-md-6">
          <ul class="form edit-form">
            <li><label>Operating Profit:</label><input id="curOperatingProfit" value="{{current.account.customFields['operatingProfit']}}"/></li>
            <li><label>Adjustments:</label><input id="curAdjustments" value="{{current.account.customFields['adjustments']}}"/></li>
            <li><label>Borrowing:</label><input id="curBorrowing" value="{{current.account.customFields['borrowing']}}"/></li>
          </ul>
        </div> 
        <div class="col-md-12">
          <fieldset>
            <legend>Current Year</legend>
            <label>Financial Year:</label><input id="curUnknown" value="{{current.account.customFields['currentFinancialYear']}}"/>
            <label>Turnover:</label><input id="curUnknown" value="{{current.account.customFields['currentTurnover']}}"/>
            <label>Profit:</label><input id="curUnknown" value="{{current.account.customFields['currentProfit']}}"/>
          </fieldset>
          <fieldset>
            <legend>Last Year</legend>
            <label>Financial Year:</label><input id="curLastFinancialYear" value="{{current.account.customFields['lastFinancialYear']}}"/>
            <label>Turnover:</label><input id="curLastTurnover" value="{{current.account.customFields['lastTurnover']}}"/>
            <label>Profit:</label><input id="curLastProfit" value="{{current.account.customFields['lastProfit']}}"/>
          </fieldset>
          <fieldset>
            <legend>Previous Year</legend>
            <label>Financial Year:</label><input id="curPreviousFinancialYear" value="{{current.account.customFields['previousFinancialYear']}}"/>
            <label>Turnover:</label><input id="curPreviousTurnover" value="{{current.account.customFields['previousTurnover']}}"/>
            <label>Profit:</label><input id="curPreviousProfit" value="{{current.account.customFields['previousProfit']}}"/>
          </fieldset>

        </div>
      </div>

      <div class="col-md-12" id="currentAccountExtended">
        <h2 class="form"><span>Valuation</span></h2> 
        <div class="col-md-6">
          <ul class="form edit-form">
            <li><label>Low Quote:</label><input id="curLowQuote" value="{{current.account.customFields['lowQuote']}}"/></li>
            <li><label>Medium Quote:</label><input id="curMediumQuote" value="{{current.account.customFields['mediumQuote']}}"/></li>
            <li><label>High Quote:</label><input id="curHighQuote" value="{{current.account.customFields['highQuote']}}"/></li>
          </ul>
        </div> 
        <div class="col-md-6">
          <ul class="form edit-form">
            <li><label>Asking Price:</label><input id="curAskingPrice" value="{{current.account.customFields['askingPrice']}}"></li>
            <li><label>Preferred Timing:</label><input id="curPreferredTiming" value="{{current.account.customFields['preferredTiming']}}"/></li>
          </ul>
        </div> 

      </div>
    <!-- {{/firmgainsAccountExtension}} -->

    <!-- {{>column}} -->
      <div class="col-md-6">
        <ul class="form edit-form">
          {{#each fields:j}}
            <li><label>{{label}}:</label><input id="curUnknown" value="{{object.customFields[key]}}"></li>
          {{/each}}
        </ul>
      </div>
    <!-- {{/column}} -->

  </script>


  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="js/jquery-1.11.0.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="js/bootstrap.min.js"></script>
  <script src="js/bootstrap3-typeahead.js"></script>
  <!--
       3. You can always get the most recent stable version from the URL below.
       If you want the newest features, use the 'edge' version instead:

           http://cdn.ractivejs.org/edge/ractive.min.js

       If you need IE8 support, change 'ractive' to 'ractive-legacy'.
  -->
  <script src="js/ractive.min.js"></script>
  <script src="js/custmgmt-0.1.0.js"></script>
  <script>
    $(document).ready(function() {
      ractive.set('tenant', { 
        name: 'firmgains', 
        typeaheadControls: [
          { selector: '#curEnquiryType', url: '/data/firmgains/enquiry-types.json'},
          { selector: '#curMedium', url: '/data/media.json'},
          { selector: '#curSource', url: '/data/sources.json'},
          { selector: '#curStage', url: '/data/stages.json'}
        ]
      });
      $.ajaxSetup({
        headers: {'X-Tenant': ractive.data.tenant.name}
      });
      ractive.fetch();
      ractive.initAutoComplete();
    });
  </script>

  <h1 class="powered-by" style="float: left;opacity:0.5;transform: rotate(-90deg) translate(220px,-120px);transform-origin: left top 0;">
    <span class="powered-by-text">powered by</span>
    <img src="images/omny-greyscale-logo.png" alt="powered by Omny Link"/>   
  </h1>

</body>
</html>
