<section id="currentSect" style="display:none">
  <form class="inline-form form" id="currentForm">
    {{^current.id}}
      <div class="form create-form">
        <input class="create-field form-control col-xs-1" id="curTitle" placeholder="Title" value="{{current.title}}"/>
        <input class="create-field form-control col-xs-2" id="curFirstName" placeholder="First Name" required value="{{current.firstName}}"/>
        <input class="create-field form-control col-xs-2" id="curLastName" placeholder="Last Name" required value="{{current.lastName}}"/>
      </div>
      <h2 class="create-form" style="">&nbsp;</h2>
    {{/}}
    
    {{#current.id}}
      <h2 class="edit-form">
        <img class="img-rounded" src="//www.gravatar.com/avatar/{{hash(current.email)}}?d=blank&s=36" style="margin-top:-10px"/>
        <span contenteditable id="curTitle2" on-focus="editField('#curTitle2','current.title')" on-blur="updateField('#curTitle2','current.title')">{{current.title}}</span>
        <span contenteditable id="curFirstName2" on-focus="editField('#curFirstName2','current.firstName')" on-blur="updateField('#curFirstName2','current.firstName')">{{current.firstName}}</span>
        <span contenteditable id="curLastName2" on-focus="editField('#curLastName2','current.lastName')" on-blur="updateField('#curLastName2','current.lastName')">{{current.lastName}}</span>
        {{#if (current.phone1 != undefined || current.phone2 != undefined) && (current.phone1 != '' || current.phone2 != '')}}
          {{#if (current.phone1 != undefined && current.phone1 != '')}}
            <a class="clickable glyphicon glyphicon-earphone" href="tel:{{current.phone1}}" title="Click to call"></a>
            <span>{{current.phone1}}</span>
          {{/if}}
          {{#if (current.phone2 != undefined && current.phone2 != '')}}
            <a class="clickable glyphicon glyphicon-earphone" href="tel:{{current.phone2}}" title="Click to call"></a>
            <span> {{current.phone2}}</span>
          {{/if}}
        {{/if}}
        {{#if current.email != undefined && current.email != ''}}
          <a class="clickable glyphicon glyphicon-envelope" href="mailto:{{current.email}}" title="Click to email"></a>
        {{/if}}
        <a class="clickable glyphicon glyphicon-paperclip" href="#notes" title="Jump to Notes"></a>
        <span class="pull-right">
          <a class="clickable admin glyphicon glyphicon-remove" aria-hidden="true" on-click="delete(current)" title="Delete this record"></a>
          {{#if tenant.contactActions!=undefined && tenant.contactActions.length>0 }}
            <span class="clickable dropdown" aria-hidden="true" title="Start Process">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown" id="customActionBtn" role="button" aria-expanded="false">
                <a class="clickable glyphicon glyphicon-play dropdown" aria-hidden="true" title="Start Process"> <span class="caret"></a>
              </a>
              <ul class="omny-dropdown dropdown-menu" id="customActionMenu" role="menu">
                {{#each tenant.contactActions }}
                  {{#name}}
                    <li onclick="ractive.startCustomAction('{{ref}}', '{{name}}', ractive.get('current'){{#url}}, '{{url}}'{{/url}})">{{name}}</li>
                  {{else}}
                    <li class="divider"></li>
                  {{/}}
                {{/each}}
              </ul>
            </span>
          {{/if}}
        </span>
      </h2>
    {{/}}
    
    <div class="currentBody col-md-6 col-sm-12 col-xs-12">
      <ul class="form edit-form">
        <li>
          <label class="">Owner: </label>
          <input class="typeahead form-control" placeholder="Start typing to filter options" id="curOwner" value="{{current.owner}}">
        </li>
        <li>
          <label class="">Stage:</label>
          <input class="typeahead form-control" placeholder="Start typing to filter options" id="curStage" value="{{current.stage}}">
          <p class="col-md-offset-4 hidden-sm hidden-xs help-block">How far through the sales pipeline are you with this contact?</p>
        </li>
        {{# haveStageReasons() }}
          <li>
            <label class="">Reason:</label>
            <input class="typeahead form-control" placeholder="Start typing to filter options" id="curStageReason" value="{{current.stageReason}}">
          </li>
        {{/}}
      </ul>
    </div>
    <div class="currentBody col-md-6 col-sm-12 col-xs-12">
      <ul class="form edit-form">
        <li>
          <label class="">Enquiry Type:</label>
          <input class="typeahead form-control" placeholder="Start typing to filter options" id="curEnquiryType" value="{{current.enquiryType}}">
          <p class="col-md-offset-4 hidden-sm hidden-xs help-block">The nature of the initial contact</p>
        </li>
        <li>
          <label class="">Account Type:</label>
          <input class="typeahead form-control" placeholder="Start typing to filter options" placeholder="Start typing to filter options" id="curAccountType" value="{{current.accountType}}">
          <p class="col-md-offset-4 hidden-sm hidden-xs help-block">Defines the nature of the relationship with this contact</p>
        </li>
        <li>
          <label class="" style="margin-right:5px">Tags:</label>
          <input class="tag-ctrl form-control" id="curTags" data-bind="current.tags"/>
        </li>
      </ul>
    </div>

    <section id="connectionsSect" style="clear:both;">
      <h3>
        <span class="ol-collapse glyphicon glyphicon-triangle-right" onclick="ractive.toggleSection($(this).closest('section'))"></span>
        <span> Contact Information</span>
      </h3>
      <div class="currentBody col-md-6 col-sm-12 col-xs-12" style="display:none">
        <ul class="form edit-form">
          <li>
            <label class="required">Email:</label>
            <input class="form-control" id="curEmail" required type="email" value="{{current.email}}">
          </li>
          <li>
            <label class="">Confirmed?:</label>
            <input class="" id="curEmailConfirmed" type="checkbox" checked="{{current.emailConfirmed}}">
            <p class="col-md-offset-4 hidden-sm hidden-xs help-block">Has this email been confirmed valid?</p>
          </li>
          <li>
            <label class="">Do Not Email:</label>
            <input class="" id="curDoNotEmail" type="checkbox" checked="{{current.doNotEmail}}"> Owner preference
            <p class="col-md-offset-4 hidden-sm hidden-xs help-block">Check this if the user should not receive automated emails, for example during sensitive negotiations</p>  
          </li>
          <li>
            <label class="">Opt out:</label>
            <input class="" id="curOptOut" type="checkbox" checked="{{current.optOut}}"> User preference
            <p class="col-md-offset-4 hidden-sm hidden-xs help-block">This will be checked if the user has opted-out of / unsubscribed from marketing emails</p>
          </li>
          <li class="form-group">
            <label class="col-md-4">Twitter:</label>
            <div class="input-group">
              <input class="form-control" id="curTwitter" pattern="@[a-z0-9_]{1,15}" type="text" value="{{current.twitter}}"/>
              <span class="input-group-addon">
                <a href="https://twitter.com/{{current.twitter}}" target="_newtab"><span class="glyphicon glyphicon-new-window"></span></a>
              </span>
            </div>
            <p class="col-md-offset-4 hidden-sm hidden-xs help-block">Remember to include @</p>
          </li>
          <li class="form-group">
            <label class="col-md-4">Facebook:</label>
            <div class="input-group">
              <input class="form-control" id="curFacebook" type="url" value="{{current.facebook}}"/>
              <span class="input-group-addon">
                <a href="{{current.facebook}}" target="_newtab"><span class="glyphicon glyphicon-new-window"></span></a>
              </span>
            </div>
            <p class="col-md-offset-4 hidden-sm hidden-xs help-block">Remember to include http:// (or https://)</p>
          </li>
          <li class="form-group">
            <label class="col-md-4">LinkedIn:</label>
            <div class="input-group">
              <input class="form-control" id="curLinkedIn" type="url" value="{{current.linkedIn}}"/>
              <span class="input-group-addon">
                <a href="{{current.linkedIn}}" target="_newtab"><span class="glyphicon glyphicon-new-window"></span></a>
              </span>
            </div>
            <p class="col-md-offset-4 hidden-sm hidden-xs help-block">Remember to include http:// (or https://)</p>
          </li>
        </ul>
      </div>
      <div class="currentBody col-md-6 col-sm-12 col-xs-12" style="display:none">
        <ul class="form edit-form">
          <li>
            <label class="">Preferred Phone:</label>
            <input class="form-control" id="curPhone1" pattern="\+?[0-9, \-()]{0,15}" value="{{current.phone1}}">
          </li>
          <li>
            <label class="">Alternate Phone:</label>
            <input class="form-control" id="curPhone2" pattern="\+?[0-9, \-()]{0,15}" value="{{current.phone2}}">
          </li>
          <li>
            <label class="">Do Not Call:</label>
            <input class="" id="curDoNotCall" type="checkbox" checked="{{current.doNotCall}}">
          </li>
          <li>
            <label class="">Address:</label>
            <input class="form-control" id="curAddress1" value="{{current.address1}}"/>
          </li>
          <li>
            <label class=""></label>
            <input class="form-control" id="curAddress2" value="{{current.address2}}"/>
          </li>
          <li>
            <label class=""></label>
            <input class="form-control" id="curTown" placeholder="Town or village" value="{{current.town}}"/>
          </li>
          <li>
            <label class=""></label>
            <input class="form-control" id="curCountyOrCity" placeholder="City, county or other province" value="{{current.countyOrCity}}"/>
          </li>
          <li>
            <label class="">Post Code:</label>
            <input class="form-control" id="curPostCode" pattern="[a-z,A-Z,0-9, ]{5,9}" value="{{current.postCode}}">
          </li>
          <li>
            <label class="">Country:</label>
            <input autocomplete="false" class="typeahead form-control" placeholder="Start typing to filter options" id="curCountry" value="{{current.country}}">
          </li>
          {{#current.postCode}}
            <li>
              <label class="">Map:</label>
              <a class="glyphicon glyphicon glyphicon-map-marker" href="//www.google.com/maps/place/{{current.postCode}}" target="_blank"></a>
            </li>
          {{/}}
          {{^current.postCode}}
            {{#current.town || current.address1 || current.address2 || current.countyOrCity}}
              <li>
                <label class="">Map:</label>
                <a class="glyphicon glyphicon glyphicon-map-marker" href="//www.google.com/maps/place/{{current.address1}}+{{current.address2}}+{{current.town}}+{{current.countyOrCity}}" target="_blank"></a>
              </li>
            {{/}}
          {{/}}
        </ul>
      </div>
    </section>

    {{#tenant.show.marketing}}
      <section id="marketingSect" style="clear:both;">
        <h3>
          <span class="ol-collapse glyphicon glyphicon-triangle-right" onclick="ractive.toggleSection($(this).closest('section'))"></span>
          <span> Marketing</span>
        </h3>
        <div class="currentBody col-md-6 col-sm-12 col-xs-12" style="display:none">
          <ul class="form edit-form">
            <li>
              <label class="">Source:</label>
              <input class="typeahead form-control" placeholder="Start typing to filter options" id="curSource" {{ current.source ? 'disabled readonly' : '' }} value="{{current.source}}">
            </li>
            <li>
              <label class="">Medium:</label>
              <input class="typeahead form-control" placeholder="Start typing to filter options" id="curMedium" {{ current.medium ? 'disabled readonly' : '' }} value="{{current.medium}}">
            </li>
            {{#tenant.show.declaredSource}}
              <li>
                <label class="">How heard of us?:</label>
                <input class="form-control" id="curSource2" {{ current.source2 ? 'disabled readonly' : '' }} value="{{current.source2}}">
              </li>
            {{/}}
          </ul>
        </div>
        <div class="currentBody col-md-6 col-sm-12 col-xs-12" style="display:none">
          <ul class="form edit-form">
            <li>
              <label class="">Page Submitted:</label>
              <input class="form-control" id="curPageSubmitted" disabled readonly value="{{customField(current, 'pageSubmitted')}}">
            </li>
            <li>
              <label class="">Campaign:</label>
              <input class="form-control" id="curCampaign" {{ current.campaign ? 'disabled readonly' : '' }} value="{{current.campaign}}">
            </li>
            <li>
              <label class="">IP Address:</label>
              <input class="form-control" id="curIpAddress" disabled readonly value="{{customField(current, 'ip')}}">
            </li>
          </ul>
        </div>
      </section>
    {{/tenant.show.marketing}}

    {{#tenant.show.budget}}
      <section id="budgetSect" style="clear:both;">
        <h3>
          <span class="ol-collapse glyphicon glyphicon-triangle-right" onclick="ractive.toggleSection($(this).closest('section'))"></span>
          <span>Budget</span>
        </h3>
        <div class="currentBody col-md-6 col-sm-12 col-xs-12" style="display:none">
          <ul class="form edit-form">
            <li>
              <label class="">Budget:</label>
              <input class="autoNumeric form-control" data-a-sign="£ " id="curBudget" on-blur="ractive.save()" value="{{current.customFields['budget']}}">
            </li>
          </ul>
        </div>
        <div class="currentBody col-md-6 col-sm-12 col-xs-12" style="display:none">
          <ul class="form edit-form">
            <li>
              <label class="">Discussed Budget?:</label>
              <input class="form-control" id="curDiscussedBudget" on-blur="ractive.save()" type="checkbox" checked="{{current.customFields['discussedBudget']}}">
            </li>
          </ul>
        </div>
      </section>
    {{/tenant.show.account}}

    <div id="currentContactExtended" style="clear: both">
      {{>(tenant.id+'ContactExtension')}}
    </div>
  </form>

  {{#tenant.show.account}}
    <section id="currentAccount" style="clear: both">
      <form id="currentAccountForm" class="form">
        <h2 title="Activities are added automatically by the workflows">
          <span class="ol-collapse glyphicon glyphicon-triangle-bottom" onclick="ractive.toggleSection($(this).closest('section'))"></span>
          <span>Account</span>
        </h2>
        <div class="currentBody col-md-6 col-sm-12 col-xs-12">
          <ul class="form edit-form">
            <li class="form-group">
              <label class="col-md-4 required">Company Name:</label>
              <input autocomplete="off" class="typeahead form-control" id="curAccountName" required value="{{current.account.name}}">
            </li>
            <li class="form-group">
              <label class="col-md-4">Company Number:</label>
              <input autocomplete="off" class="typeahead form-control" id="curCompanyNumber" pattern="[OCS0-9]{2}[0-9]{6}" placeholder="Start typing to filter options" type="text" value="{{current.account.companyNumber}}">
            </li>
            {{# false && current.account.companyNumber}}
              <li class="form-group">
                <label class="col-md-4"></label>
                <a href="https://beta.companieshouse.gov.uk/company/{{current.account.companyNumber}}" target="_newTab">View Companies House Information</a>
              </li>
            {{/}}
            <li class="form-group">
              <label class="col-md-4">No. of employees:</label>
              <select class="form-control" id="curNoOfEmployees" placeholder="Please choose the number of employees you have">
                 <option value="Please select" selected="">Please select</option>
                 <option value="under10">less than 10</option> 
                 <option value="10-49">10-49</option> 
                 <option value="50-99">50-99</option>
                 <option value="100-249">100-249</option>
                 <option value="250-499">250-499</option>
                 <option value="500-999">500-999</option>
                 <option value="1000+">over 1000</option>
               </select>
            </li>
            <li class="form-group">
              <label class="col-md-4">Founded:</label>
              <input autocomplete="off" class="form-control" id="curIncorporationYear" pattern="[0-9]{4}" placeholder="yyyy" type="text" value="{{current.account.incorporationYear}}">
            </li>
            <li class="form-group">
              <label class="col-md-4">SIC:</label>
              <input autocomplete="off" class="typeahead form-control" id="curSic" type="text" value="{{current.account.sic}}">
              <p class="col-md-offset-4 hidden-sm hidden-xs help-block">Standard industrial classification of economic activities (SIC)</p>
            </li>
          </ul>
        </div>
        <div class="currentBody col-md-6 col-sm-12 col-xs-12">
          <ul class="form edit-form">
            <li class="form-group">
              <label class="col-md-4">Website:</label>
              <div class="input-group">
                <input class="form-control" id="curBusinessWebsite" type="url" value="{{current.account.businessWebsite}}"/>
                <span class="input-group-addon">
                  <a href="{{current.account.businessWebsite}}" target="_newtab"><span class="glyphicon glyphicon-new-window"></span></a>
                </span>
              </div>
              <p class="col-md-offset-4 hidden-sm hidden-xs help-block">Remember to include http:// (or https://)</p>
            </li>
            <li class="form-group">
              <label class="col-md-4">Twitter:</label>
              <div class="input-group">
                <input class="form-control" id="curBusinessTwitter" pattern="@[a-z0-9_]{1,15}" type="text" value="{{current.account.twitter}}"/>
                <span class="input-group-addon">
                  <a href="https://twitter.com/{{current.account.twitter}}" target="_newtab"><span class="glyphicon glyphicon-new-window"></span></a>
                </span>
              </div>
              <p class="col-md-offset-4 hidden-sm hidden-xs help-block">Remember to include @</p>
            </li>
            <li class="form-group">
              <label class="col-md-4">Facebook:</label>
              <div class="input-group">
                <input class="form-control" id="curBusinessFacebook" type="url" value="{{current.account.facebook}}"/>
                <span class="input-group-addon">
                  <a href="{{current.account.facebook}}" target="_newtab"><span class="glyphicon glyphicon-new-window"></span></a>
                </span>
              </div>
              <p class="col-md-offset-4 hidden-sm hidden-xs help-block">Remember to include http:// (or https://)</p>
            </li>
            <li class="form-group">
              <label class="col-md-4">LinkedIn:</label>
              <div class="input-group">
                <input class="form-control" id="curBusinessLinkedIn" type="url" value="{{current.account.linkedIn}}"/>
                <span class="input-group-addon">
                  <a href="{{current.account.linkedIn}}" target="_newtab"><span class="glyphicon glyphicon-new-window"></span></a>
                </span>
              </div>
              <p class="col-md-offset-4 hidden-sm hidden-xs help-block">Remember to include http:// (or https://)</p>
            </li>
          </ul>
        </div>

        <div id="currentAccountDesc" style="clear: both" class="col-md-12 col-sm-12 col-xs-12">
            <ul class="form edit-form">
              <li class="form-group">
                <label class="textarea col-md-2">Description:</label>
                <textarea class="col-md-10 form-control" id="curDescription" cols="80" value="{{current.account.description}}"></textarea>
              </li>
            </ul>
        </div>

        <div id="currentAccountTypeExtended" style="clear: both">
          {{>(tenant.id+current.accountType+'Extension')}}
        </div>
      </form>
    </section>

    {{#tenant.show.companyBackground}}
      {{>currentCompanyBackground}}
    {{/}}
  {{/}}

  {{#if current['activities'] != undefined && tenant.show.activityAnalysis}}
    <section id="activityAnalysisSect" style="clear:both">
      <h2>
        <span class="ol-collapse glyphicon glyphicon-triangle-bottom" onclick="ractive.toggleSection($(this).closest('section'))"></span>
        <span>At a glance</span>
      </h2>
      <div class="currentBody col-md-6 col-sm-12 col-xs-12">
        <ul class="form edit-form">
          <li class="form-group">
            <label class="col-md-4">Since login:</label>
            <input class="form-control" id="curTimeSinceLogin" disabled readonly value="{{formatAge(current.timeSinceLogin)}}">
          </li>
          <li class="form-group">
            <label class="col-md-4">Since registration:</label>
            <input class="form-control" id="curTimeSinceRegistration" disabled readonly value="{{formatAge(current.timeSinceRegistered)}}">
          </li>
          <li class="form-group">
            <label class="col-md-4">Since valuation:</label>
            <input class="form-control" id="curTimeSinceValuation" disabled readonly value="{{formatAge(current.timeSinceValuation)}}">
          </li>
        </ul>
      </div>
      <div class="currentBody col-md-6 col-sm-12 col-xs-12">
        <ul class="form edit-form">
          <li class="form-group">
            <label class="col-md-4">Since email:</label>
            <input class="form-control" id="curTimeSinceEmail" disabled readonly value="{{formatAge(current.timeSinceEmail)}}">
          </li>
          <li class="form-group">
            <label class="col-md-4">Mails sent:</label>
            <input class="form-control" id="curEmailsSent" disabled readonly value="{{current.emailsSent}}">
          </li>
        </ul>
      </div>
    </section>

    <section id="activitySect" style="clear: both">
      <h2 title="Activities are added automatically by the workflows">
        <span class="ol-collapse glyphicon glyphicon-triangle-right" onclick="ractive.toggleSection($(this).closest('section'))"></span>
        <span>Activities ({{current.activities.length}})</span>
      </h2>
      <div style="display:none">
        <table id="activitiesTable" class="table table-striped"><tbody>
          {{#each current.activities:j}}
            <tr>
              <td class="field-occurred">{{age(occurred)}} ({{formatDate(occurred)}})</td>
              <td class="field-type">{{type}}</td>
              <td class="field-text" id="activity{{j}}">{{{formatJson(content)}}}</td>
            </tr>
          {{/each}}
          {{^ current.activities }}
            <tr><td>None</td></tr>
          {{/ current.activities }}
        </tbody></table>
      </div>
    </section>
  {{/if}}
  
  <div style="clear: both"></div>

  <form id="noteForm">
   <div id="notesSect" style="clear: both">
    <h2 id="notes">
      <span>Notes</span>
      <span class="clickable glyphicon glyphicon-plus" aria-hidden="true" onclick="ractive.addNote('{{current._links.self.href}}')" title="Add a new note"></span>
    </h2>
    <table id="notesTable" class="table table-striped"><tbody>
      <tr style="display:none;">
        <td colspan="3">
          <textarea id="note" on-blur="saveNote()" placeholder="Type your note here" required style="width:100%;"></textarea>
          <br/>
          <a onclick="$('#notesTable tr:nth-child(1)').slideUp();">Cancel</a>
        </td>
      </tr>
      {{#each current.notes:j}}
        <tr>
          <td class="field-age">{{age(created)}} ({{formatDate(created)}})</td>
          <td class="field-author">{{{gravatar(author)}}}</td>
          <td class="field-text">{{{content}}}</td>
        </tr>
      {{/each}}
      {{^ current.notes }}
        <tr><td>None</td></tr>
      {{/ current.notes }}
    </tbody></table>
   </div>
  </form>

  <form id="documentForm">
   <div id="documentSect" style="clear: both">
    <h2>
      <span>Documents</span>
      <span class="clickable glyphicon glyphicon-plus" aria-hidden="true" onclick="ractive.addDoc('{{current._links.self.href}}')" title="Add a new Document"></span>
    </h2>
    <table id="docsTable" class="table table-striped"><tbody>
      <tr style="display:none;">
        <td colspan="3">
          <input class="form-control" id="doc" on-blur="saveDoc()" placeholder="Paste document link here" required style="width:100%;"/>
          <br/>
          <a onclick="$('#docsTable tr:nth-child(1)').slideUp();">Cancel</a>
        </td>
      </tr>
      {{#each current.documents:k}}
        <tr>
          <td class="field-age">{{age(created)}} ({{formatDate(created)}})</td>
          <td class="field-author">{{{gravatar(author)}}}</td>
          <td class="field-url"><a href="{{url}}" target="_newtab"><span class="glyphicon glyphicon-new-window"></span>Click to open</a></td>
        </tr>
      {{/each}}
      {{^ current.documents }}
        <tr><td>None</td></tr>
      {{/ current.documents }}
    </tbody></table>
   </div>
  </form>

</section>
