<section id="currentSect" style="display:none">
  <form class="inline-form form" id="currentForm">
    {{^current.selfRef}}
      <h2 class="form create-form">
        <input class="create-field form-control col-xs-1" id="curTitle" placeholder="Title" value="{{current.title}}"/>
        <input class="create-field form-control col-xs-2" id="curFirstName" placeholder="First Name" required value="{{current.firstName}}"/>
        <input class="create-field form-control col-xs-2" id="curLastName" placeholder="Last Name" required value="{{current.lastName}}"/>
      </h2>
    {{/}}
    
    {{#current.id}}
      <h2 class="edit-form">
        <img class="img-rounded" src="//www.gravatar.com/avatar/{{hash(current.email)}}?d=blank&s=36" style="margin-top:-10px"/>
        <span contenteditable id="curTitle2" on-focus="editField('#curTitle2','current.title')" on-blur="updateField('#curTitle2','current.title')">{{current.title}}</span>
        <span contenteditable id="curFirstName2" on-focus="editField('#curFirstName2','current.firstName')" on-blur="updateField('#curFirstName2','current.firstName')">{{current.firstName}}</span>
        <span contenteditable id="curLastName2" on-focus="editField('#curLastName2','current.lastName')" on-blur="updateField('#curLastName2','current.lastName')">{{current.lastName}}</span>
        {{#if (current.phone1 != undefined || current.phone2 != undefined) && (current.phone1 != '' || current.phone2 != '')}}
          {{#if (current.phone1 != undefined && current.phone1 != '')}}
            <a class="clickable glyphicon glyphicon-earphone" href="tel:{{current.phone1}}" title="Click to call"></a>
            <span class="hidden-sm hidden-xs">{{current.phone1}}</span>
          {{/if}}
          {{#if (current.phone2 != undefined && current.phone2 != '')}}
            <a class="clickable glyphicon glyphicon-earphone" href="tel:{{current.phone2}}" title="Click to call"></a>
            <span class="hidden-sm hidden-xs"> {{current.phone2}}</span>
          {{/if}}
        {{/if}}
        {{#if current.email != undefined && current.email != ''}}
          <a class="clickable glyphicon glyphicon-envelope" href="mailto:{{current.email}}" title="Click to email"></a>
          <span class="hidden-sm hidden-xs">{{current.email}}</span>
        {{/if}}
        <span class="pull-right">
          {{#matchRole('admin')}}
            <a class="clickable glyphicon glyphicon-remove" aria-hidden="true" on-click="delete(current)" style="top: -1px;right:-8px" title="Delete this record"></a>
          {{/}}
          <a class="clickable glyphicon glyphicon-paperclip" href="#notes" title="Jump to Notes"></a>
          {{#if tenant.contactActions!=undefined && tenant.contactActions.length>0 }}
            <span class="clickable dropdown" aria-hidden="true" title="Start Process">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown" id="customActionBtn" role="button" aria-expanded="false">
                <a class="clickable glyphicon glyphicon-play dropdown" aria-hidden="true" title="Perform action"> <span class="caret"></a>
              </a>
              <ul class="omny-dropdown dropdown-menu" id="customActionMenu" role="menu">
                {{#each tenant.contactActions }}
                  {{#name}}
                    <li onclick="ractive.startCustomAction('{{ref}}', '{{name}}', ractive.get('current'){{#url}}, '{{url}}'{{/url}}, '{{current.fullName}}')" title="{{name}}">{{name}}</li>
                  {{else}}
                    <li class="divider"></li>
                  {{/}}
                {{/each}}
              </ul>
            </span>
          {{/if}}
        </span>
        <span class="clearfix">
         {{#if tenant.show.addressAccount && (current.account.name != undefined && current.account.name != '')}}
           <span>{{current.account.name}}{{#if current.account.town}}, {{current.account.town}}{{/if}}{{#if current.account.countyOrCity}}, {{current.account.countyOrCity}}{{/if}}{{#if current.account.postCode}}, {{current.account.postCode}}{{/if}}</span>
             {{#current.account.postCode}}
                <a class="glyphicon glyphicon glyphicon-map-marker" href="//www.google.com/maps/place/{{current.account.postCode}}" target="_blank"></a>
             {{/}}
             {{^current.account.postCode}}
               {{#current.account.town || current.account.address1 || current.account.address2 || current.account.countyOrCity}}
                 <a class="glyphicon glyphicon glyphicon-map-marker" href="//www.google.com/maps/place/{{current.account.address1}}+{{current.account.address2}}+{{current.account.town}}+{{current.account.countyOrCity}}" target="_blank"></a>
               {{/}}
             {{/}}
          {{/if}}
        </span>
      </h2>
    {{/}}
    
    <div class="currentBody col-md-6 col-sm-12 col-xs-12">
      <ul class="form edit-form">
        {{#if tenant.show.references || matchRole('admin') || matchRole('super-admin')}}
          <li>
            <label class="col-md-4 col-sm-4 col-xs-4">Ref: </label>
            <div class="input-group">
              <input class="col-md-8 col-sm-8 col-xs-8 form-control" id="curId" readonly disabled value="{{current.id}}"/>
              <span class="input-group-addon">
                <a href="contacts.html?id=/contacts/{{current.id}}" target="_blank"><span class="glyphicon glyphicon-new-window"></span></a>
              </span>
            </div>
          </li>
        {{/if}}
        <li class="form-group">
          <label class="col-md-4 col-sm-4 col-xs-4">{{#tenant.strings.owner}}{{tenant.strings.owner}}{{else}}Owner{{/}}: </label>
          <input class="typeahead form-control" placeholder="Start typing to filter options" id="curOwner" value="{{current.owner}}">
        </li>
        {{#tenant.show.marketing || tenant.show.stage}}
          <li class="form-group">
            <label class="col-md-4 col-sm-4">Relationship:</label>
            <label class="radio-inline">
              <input type="radio" name="curExistingCustomer" id="inlineRadio1" checked="{{current.existingCustomer}}" value="true"> Existing Customer
            </label>
            <label class="radio-inline">
              <input type="radio" name="curExistingCustomer" id="inlineRadio2" checked="{{!current.existingCustomer}}" value="false"> New Prospect
            </label>
            <p class="col-md-offset-4 hidden-sm hidden-xs help-block">Is this an existing customer, even if we are in a new sales cycle?</p>
          </li>
          <li class="form-group">
            <label class="col-md-4 col-sm-4">{{#tenant.strings.stage}}{{tenant.strings.stage}}{{else}}Stage{{/}}:</label>
            <input class="typeahead form-control" placeholder="Start typing to filter options" id="curStage" value="{{current.stage}}">
            <p class="col-md-offset-4 hidden-sm hidden-xs help-block">How far through the sales pipeline are you with this contact?</p>
          </li>
          {{# haveStageReasons() }}
            <li class="form-group">
              <label class="col-md-4 col-sm-4">Loss Reason:</label>
              <input class="typeahead form-control" placeholder="Start typing to filter options" id="curStageReason" {{# current.stage=='Cold' }} required{{/}} value="{{current.stageReason}}">
              <p class="col-md-offset-4 hidden-sm hidden-xs help-block">&nbsp;</p>
            </li>
            <li class="form-group">
              <label class="col-md-4 col-sm-4">Loss Date:</label>
              <input class="form-control" id="curStageDate" readonly value="{{formatDate(current.stageDate)}}">
              <p class="col-md-offset-4 hidden-sm hidden-xs help-block">&nbsp;</p>
            </li>
          {{/}}
        {{/}}
      </ul>
    </div>
    <div class="currentBody col-md-6 col-sm-12 col-xs-12">
      <ul class="form edit-form">
        {{#tenant.show.enquiryType}}
          <li>
            <label class="col-md-4 col-sm-4 col-xs-4">Enquiry Type:</label>
            <input class="typeahead form-control" placeholder="Start typing to filter options" id="curEnquiryType" value="{{current.enquiryType}}">
            <p class="col-md-offset-4 hidden-sm hidden-xs help-block">The nature of the initial contact</p>
          </li>
        {{/}}
        <li>
          <label class="col-md-4 col-sm-4 col-xs-4">Account Type:</label>
          <input class="typeahead form-control" placeholder="Start typing to filter options" placeholder="Start typing to filter options" id="curAccountType" value="{{current.accountType}}">
          <p class="col-md-offset-4 hidden-sm hidden-xs help-block">Defines the nature of the relationship with this contact</p>
        </li>
        <li>
          <label class="col-md-4 col-sm-4 col-xs-4">Tags:</label>
          <input class="tag-ctrl form-control col-md-8 col-sm-8 col-xs-8" id="curTags" data-bind="current.tags"/>
        </li>
      </ul>
    </div>
    
    {{#tenant.show.contactDescription}}
      <div id="currentContactDesc" style="clear: both" class="col-md-12 col-sm-12 col-xs-12" style="display:inline">
        <ul class="form edit-form">
          <li class="form-group">
            <label class="textarea col-md-2 col-sm-4">{{#tenant.strings.contactDescription}}{{tenant.strings.contactDescription}}{{else}}Background info{{/}}:</label>
            <textarea class="col-md-10 col-sm-8 form-control" id="curDescription" cols="80" placeholder="{{#tenant.strings.contactDescriptionHint}}{{tenant.strings.contactDescriptionHint}}{{else}}Background info{{/}}" value="{{current.description}}"></textarea>
          </li>
        </ul>
      </div>
    {{/}}

    <div id="currentContactExtended" style="clear: both">
      {{>(tenant.id+'ContactExtension')}}
    </div>
    
    <section id="connectionsSect">
      <h3>
        <span class="ol-collapse glyphicon glyphicon-triangle-right" onclick="ractive.toggleSection($(this).closest('section'))"></span>
        <span> Contact Information</span>
        <span class="alert-counter {{#alerts.connections>0}}alert-danger{{else}}alert-hidden{{/}}"> {{alerts.connections}}</span>
      </h3>
      <div class="currentBody col-md-6 col-sm-12 col-xs-12" style="display:none">
        <ul class="form edit-form">
          <li class="form-group">
            <label class="col-md-4 col-sm-4">Job Title:</label>
            <input class="form-control typeahead" id="curJobTitle" value="{{current.jobTitle}}"/>
            <p class="col-md-offset-4 hidden-sm hidden-xs help-block">&nbsp;</p>
          </li>
          <li>
            <label class="col-md-4 col-sm-4 required">Email:</label>
            <input class="form-control" id="curEmail" required type="email" value="{{current.email}}">
          </li>
          <li>
            <label class="col-md-4 col-sm-4">Confirmed?:</label>
            <input class="" id="curEmailConfirmed" type="checkbox" checked="{{current.emailConfirmed}}">
            <p class="col-md-offset-4 hidden-sm hidden-xs help-block">Has this email been confirmed valid?</p>
          </li>
          {{#tenant.show.marketing}}
            <li>
              <label class="col-md-4 col-sm-4">Do Not Email:</label>
              <input class="" id="curDoNotEmail" type="checkbox" checked="{{current.doNotEmail}}"> Owner preference
              <p class="col-md-offset-4 hidden-sm hidden-xs help-block">Check this if the user should not receive automated emails, for example during sensitive negotiations</p>  
            </li>
            <li>
              <label class="col-md-4 col-sm-4">Opt out:</label>
              <input class="" id="curOptOut" type="checkbox" checked="{{current.optOut}}"> User preference
              <p class="col-md-offset-4 hidden-sm hidden-xs help-block">This will be checked if the user has opted-out of / unsubscribed from marketing emails</p>
            </li>
          {{/}}
          {{#if tenant.show.socialContact}}
            <li>{{>socialControls}}</li>
          {{/if}}
        </ul>
      </div>
      <div class="currentBody col-md-6 col-sm-12 col-xs-12" style="display:none">
        <ul class="form edit-form">
          <li>
            <label class="col-md-4 col-sm-4">Preferred Phone:</label>
            <input class="form-control" id="curPhone1" pattern="\+?[0-9, \-()]{0,15}" type="tel" value="{{current.phone1}}">
          </li>
          <li>
            <label class="col-md-4 col-sm-4">Alternate Phone:</label>
            <input class="form-control" id="curPhone2" pattern="\+?[0-9, \-()]{0,15}" type="tel" value="{{current.phone2}}">
          </li>
          {{#tenant.show.marketing}}
            <li>
              <label class="col-md-4 col-sm-4">Do Not Call:</label>
              <input class="" id="curDoNotCall" type="checkbox" checked="{{current.doNotCall}}">
            </li>
          {{/}}
          {{#if tenant.show.addressContact}}
            <li>
              <label class="col-md-4 col-sm-4">Address:</label>
              <input class="form-control" id="curAddress1" value="{{current.address1}}"/>
            </li>
            <li>
              <label class="col-md-4 col-sm-4"></label>
              <input class="form-control" id="curAddress2" value="{{current.address2}}"/>
            </li>
            <li>
              <label class="col-md-4 col-sm-4"></label>
              <input class="form-control" id="curTown" placeholder="Town or village" value="{{current.town}}"/>
            </li>
            <li>
              <label class="col-md-4 col-sm-4"></label>
              <input class="form-control" id="curCountyOrCity" placeholder="City, county or other province" value="{{current.countyOrCity}}"/>
            </li>
            <li>
              <label class="col-md-4 col-sm-4">Post Code:</label>
              <input class="form-control" id="curPostCode" pattern="[a-z,A-Z,0-9, ]{5,9}" value="{{current.postCode}}">
            </li>
            {{#tenant.show.multiNational}}
              <li>
                <label class="col-md-4 col-sm-4">Country:</label>
                <input autocomplete="false" class="typeahead form-control" placeholder="Start typing to filter options" id="curCountry" value="{{current.country}}">
              </li>
            {{/}}
            {{#current.postCode}}
              <li>
                <label class="col-md-4 col-sm-4">Map:</label>
                <a class="glyphicon glyphicon glyphicon-map-marker" href="//www.google.com/maps/place/{{current.postCode}}" target="_blank"></a>
              </li>
            {{/}}
            {{^current.postCode}}
              {{#current.town || current.address1 || current.address2 || current.countyOrCity}}
                <li>
                  <label class="col-md-4 col-sm-4">Map:</label>
                  <a class="glyphicon glyphicon glyphicon-map-marker" href="//www.google.com/maps/place/{{current.address1}}+{{current.address2}}+{{current.town}}+{{current.countyOrCity}}" target="_blank"></a>
                </li>
              {{/}}
            {{/}}
          {{/if}}
        </ul>
      </div>

    </section>

    {{#tenant.show.marketing || tenant.show.marketingDigital}}
      <section id="marketingSect" style="clear:both;">
        <h3>
          <span class="ol-collapse glyphicon glyphicon-triangle-right" onclick="ractive.toggleSection($(this).closest('section'))"></span>
          <span> Marketing</span>
          <span class="alert-counter {{#alerts.marketing>0}}alert-danger{{else}}alert-hidden{{/}}"> {{alerts.marketing}}</span>
        </h3>
        <div class="currentBody col-md-6 col-sm-12 col-xs-12" style="display:none">
          <ul class="form edit-form">
            {{#tenant.show.marketingDigital}}
              <li>
                <label class="col-md-4 col-sm-4">Source:</label>
                <input class="typeahead form-control" placeholder="Start typing to filter options" id="curSource" {{ current.source ? 'disabled readonly' : '' }} value="{{current.source}}">
              </li>
              <li>
                <label class="col-md-4 col-sm-4">Medium:</label>
                <input class="typeahead form-control" placeholder="Start typing to filter options" id="curMedium" {{ current.medium ? 'disabled readonly' : '' }} value="{{current.medium}}">
              </li>
            {{/}}
            {{#tenant.show.declaredSource}}
              <li>
                <label class="col-md-4 col-sm-4">How heard of us?:</label>
                <input class="form-control" id="curSource2" {{ current.source2 ? 'disabled readonly' : '' }} value="{{current.source2}}">
              </li>
            {{/}}
          </ul>
        </div>
        <div class="currentBody col-md-6 col-sm-12 col-xs-12" style="display:none">
          <ul class="form edit-form">
            {{#tenant.show.marketingDigital}}
              <li>
                <label class="col-md-4 col-sm-4">Page Submitted:</label>
                <input class="form-control" id="curPageSubmitted" disabled readonly value="{{customField(current, 'pageSubmitted')}}">
              </li>
              <li>
                <label class="col-md-4 col-sm-4">Campaign:</label>
                <input class="form-control" id="curCampaign" {{ current.campaign ? 'disabled readonly' : '' }} value="{{current.campaign}}">
              </li>
              <li>
                <label class="col-md-4 col-sm-4">IP Address:</label>
                <input class="form-control" id="curIpAddress" disabled readonly value="{{customField(current, 'ip')}}">
              </li>
            {{/}}
          </ul>
        </div>
      </section>
    {{/tenant.show.marketing}}

    {{#tenant.show.budget}}
      <section id="budgetSect" style="clear:both;">
        <h3>
          <span class="ol-collapse glyphicon glyphicon-triangle-right" onclick="ractive.toggleSection($(this).closest('section'))"></span>
          <span>Budget</span>
          <span class="alert-counter {{#alerts['budget']}}alert-danger{{else}}alert-hidden{{/}}"> {{alerts.budget}}</span>
        </h3>
        <div class="currentBody col-md-6 col-sm-12 col-xs-12" style="display:none">
          <ul class="form edit-form">
            <li>
              <label class="col-md-4 col-sm-4">Budget:</label>
              <input class="autoNumeric form-control" data-a-sign="£ " id="curBudget" on-blur="ractive.save()" value="{{current.customFields['budget']}}">
            </li>
          </ul>
        </div>
        <div class="currentBody col-md-6 col-sm-12 col-xs-12" style="display:none">
          <ul class="form edit-form">
            <li>
              <label class="col-md-4 col-sm-4">Discussed Budget?:</label>
              <input class="form-control" id="curDiscussedBudget" on-blur="ractive.save()" type="checkbox" checked="{{current.customFields['discussedBudget']}}">
            </li>
          </ul>
        </div>
      </section>
    {{/}}
  </form>
  
  {{#tenant.show.account}}
    {{>currentContactAccountSect { primary: 'contacts' }}}
  {{/}}

  {{#if tenant.show.orders}}
    {{>(tenant.id+'OrderExtension')}}
  {{/if}}

  {{>activityCurrentSect}}

  {{#if current.instances}}
    {{>instanceListSect}}
  {{/if}}

  {{#if current.tasks}}
    {{>currentTaskListSect {tasks:current.tasks} }}
  {{/if}}

  {{>currentNoteListSect}}

  {{#if tenant.show.documents}}
    {{>currentDocumentListSect}}
  {{/if}}

</section>
